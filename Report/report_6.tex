\documentclass[a4paper,12pt,titlepage,finall]{article}

\usepackage[T1,T2A]{fontenc}     % форматы шрифтов
\usepackage[russian]{babel}      % пакет русификации
\usepackage{tikz}                % для создания иллюстраций
\usepackage{pgfplots}            % для вывода графиков функций
\usepackage{geometry}		 % для настройки размера полей
\usepackage{indentfirst}         % для отступа в первом абзаце секции
\usepackage{multirow}
\usepackage{fontspec}
\usepackage{tikz}  
\usepackage{fancyvrb}
\usetikzlibrary{positioning,arrows}
% выбираем размер листа А4, все поля ставим по 3см
\geometry{a4paper,left=30mm,top=30mm,bottom=30mm,right=30mm}

\setmainfont{Times New Roman}
\setmonofont{Courier New}



\setcounter{secnumdepth}{0}      % отключаем нумерацию секций

\usepgfplotslibrary{fillbetween} % для изображения областей на графиках

\begin{document}
% Титульный лист
\begin{titlepage}
    \begin{center}
	{\small \sc Московский государственный университет \\имени М.~В.~Ломоносова\\
	Факультет вычислительной математики и кибернетики\\}
	\vfill
	{\Large \sc Отчет по заданию №6}\\
  ~\\
	{\large \bf <<Сборка многомодульных программ. \\
	Вычисление корней уравнений и определенных интегралов.>>}\\ 
	~\\
	{\large \bf Вариант 11 / 1 / 3}
    \end{center}
    \begin{flushright}
	\vfill {Выполнил:\\
	студент 103 группы\\
	Никифоров~Н.~И.\\
	~\\
	Преподаватель:\\
	Кузьменкова~Е.~А.}
    \end{flushright}
    \begin{center}
	\vfill
	{\small Москва\\2018}
    \end{center}
\end{titlepage}

% Автоматически генерируем оглавление на отдельной странице
\tableofcontents
\newpage

\section{Постановка задачи}

В данной работе необходимо было реализовать программу использующую вычеслительные методы для вычисления площади ограниченной фигуры тремя кривыми. Для вычисления корней использовался метод \"вилки\", а для вычисления интегралов метод Симсона. Программа реализовывалась на двух языках программирования C и Assembly. Причём решался сложный вариант задания, когда ассемблерный код генерировался отдельной программой, получающей заданные функции в файле вместе с отрезком, на котором нужно было посчитать искомую площадь.

\newpage

\section{Математическое обоснование}

Для тестирования программы был взят набор следующих функций(рис.~\ref{plot1}):
\begin{itemize}
  \item {$2-\tan{\frac{x}{4}}$}
  \item {$x$}
  \item {$\pi*0.2$}
\end{itemize}

обоснование выбора значений $\varepsilon_1$ и $\varepsilon_2$, а

В обосновании необходимо указать требования на сходимость методов и оценки точности со ссылкой на
литературу, которая оформляется так~\cite{math}. Для выбора отрезков поиска корней и значений $\varepsilon_1$ и $\varepsilon_2$ необходимо
привести полное обоснование со всеми нужными вычислениями, а не только ответ.

\begin{figure}[h]
\centering
\begin{tikzpicture}
\begin{axis}[% grid=both,                % рисуем координатную сетку (если нужно)
             axis lines=middle,          % рисуем оси координат в привычном для математики месте
             restrict x to domain=0:4,   % задаем диапазон значений переменной x
             restrict y to domain=-1:6,  % задаем диапазон значений функции y(x)
             axis equal,                 % требуем соблюдения пропорций по осям x и y
             enlargelimits,              % разрешаем при необходимости увеличивать диапазоны переменных
             legend cell align=left,     % задаем выравнивание в рамке обозначений
             scale=2]                    % задаем масштаб 2:1

% первая функция
% параметр samples отвечает за качество прорисовки
  \addplot[green,samples=256,thick] {2-tan(deg(x/4))};
% описание первой функции
  \addlegendentry{$y=2-\tan{\frac{x}{4}}$}

% добавим немного пустого места между описанием первой и второй функций
\addlegendimage{empty legend}\addlegendentry{}

% вторая функция
% здесь необходимо дополнительно ограничить диапазон значений переменной x
\addplot[blue,samples=256,thick] {x};
\addlegendentry{$y=x$}

% дополнительное пустое место не требуется, так как формулы имеют небольшой размер по высоте

% третья функция
\addplot[red,samples=256,thick] {pi*0.2};
\addlegendentry{$y=\pi*0.2$}
\end{axis}
\end{tikzpicture}
\caption{Плоская фигура, ограниченная графиками заданных уравнений}
\label{plot1}
\end{figure}

Для усложненного варианта нужно описать наборы входных данных, на которых
программа тестировалась.

\newpage

\section{Результаты экспериментов}

В данном разделе необходимо провести результаты проведенных вычислений:
координаты точек пересечения (таблица~\ref{table1}) и площадь полученной фигуры.

\begin{table}[h]
\centering
\begin{tabular}{|c|c|c|}
\hline
Кривые & $x$ & $y$ \\
\hline
1 и 2 &  1.9561 & 1.5672 \\
2 и 3 &  0.1874 & 0.8291 \\
1 и 3 & -0.2033 & 1.2254 \\
\hline
\end{tabular}
\caption{Координаты точек пересечения}
\label{table1}
\end{table}


Результаты можно представить не только в текстовом виде, но и 
проиллюстрировать графиком (рис.~\ref{plot2}).

\begin{figure}[h]
\centering
\begin{tikzpicture}
\begin{axis}[% grid=both,                % рисуем координатную сетку (если нужно)
             axis lines=middle,          % рисуем оси координат в привычном для математики месте
             restrict x to domain=-2:4,  % задаем диапазон значений переменной x
             restrict y to domain=-1:6,  % задаем диапазон значений функции y(x)
             axis equal,                 % требуем соблюдения пропорций по осям x и y
             enlargelimits,              % разрешаем при необходимости увеличивать диапазоны переменных
             legend cell align=left,     % задаем выравнивание в рамке обозначений
             scale=2,                    % задаем масштаб 2:1
             xticklabels={,,},           % убираем нумерацию с оси x
             yticklabels={,,}]           % убираем нумерацию с оси y

% первая функция
% параметр samples отвечает за качество прорисовки
\addplot[green,samples=256,thick,name path=A] {3/((x-1)^2+1)};
% описание первой функции
\addlegendentry{$y=\frac{3}{(x-1)^2+1}$}

% добавим немного пустого места между описанием первой и второй функций
\addlegendimage{empty legend}\addlegendentry{}

% вторая функция
% здесь необходимо дополнительно ограничить диапазон значений переменной x
\addplot[blue,domain=-0.5:4,samples=256,thick,name path=B] {sqrt(x+0.5)};
\addlegendentry{$y=\sqrt{x+0.5}$}

% дополнительное пустое место не требуется, так как формулы имеют небольшой размер по высоте

% третья функция
\addplot[red,samples=256,thick,name path=C] {exp(-x)};
\addlegendentry{$y=e^{-x}$}

% закрашиваем фигуру
\addplot[blue!20,samples=256] fill between[of=A and B,soft clip={domain=0.1824:1.9561}];
\addplot[blue!20,samples=256] fill between[of=A and C,soft clip={domain=-0.2033:0.1924}];
\addlegendentry{$S=2.3386$}

% Поскольку автоматическое вычисление точек пересечения кривых в TiKZ реализовать сложно,
% будем явно задавать координаты.
\addplot[dashed] coordinates {(-0.2033, 1.2254) (-0.2033, 0)};
\addplot[color=black] coordinates {(-0.2033, 0)} node [label={-135:{\small -0.2033}}]{};

\addplot[dashed] coordinates {(0.1874, 0.8291) (0.1874, 0)};
\addplot[color=black] coordinates {(0.1874, 0)} node [label={-45:{\small 0.1874}}]{};

\addplot[dashed] coordinates {(1.9561, 1.5672) (1.9561, 0)};
\addplot[color=black] coordinates {(1.9561, 0)} node [label={-90:{\small 1.9561}}]{};

\end{axis}
\end{tikzpicture}
\caption{Плоская фигура, ограниченная графиками заданных уравнений}
\label{plot2}
\end{figure}

\newpage

\section{Структура программы и спецификация функций}

Программа для генерации ассемблерного кода состоит из трёх модулей.
\begin{enumerate}
  \item Первый главный модуль этой программы состоит из функций:
  \begin{itemize}
    \item {\bf \ttfamily void bind\_fun\_data(function *f1, int *offest)} функция пишет в ассемблерный файл в секцию rodata константы, которые использует функция.
    \item {\bf \ttfamily void bind\_section\_data(function *f1, function *f2, \newline function *f3, double a, double b)} оболочка для предыдущей функции, которая использует её для записи в файл констант всех функций, так же она пишет в секцию rodata границы отрезка и константу e.
    \item {\bf \ttfamily void bind\_function(function *fun, int counter)} функция пишет в ассемблерный файл функцию, поданную ей в качестве аргумента ввиде масива структур.
  \end{itemize}

  \item Второй модуль используется для парсинга текстового файла с исходными функциями. В нём представленны следующие функции:
  \begin{itemize}
    \item {\bf \ttfamily int parse\_sym(char now)} функция возращает тип поданного на фход символа.
    \item {\bf \ttfamily void read\_fun(FILE *file, mem *fun)} функция разбирает строчку из файла интерпретируя её как обратную польскую запись и записывает её в массив логических элементов.
    \item {\bf \ttfamily void read\_file(FILE *file, mem *f1, mem *f2, mem *f3, \newline double *a, double *b)} функция является оболочкой для предыдущей функции и читает из файла три функии.
    \item {\bf \ttfamily void print\_fun(mem *fun)} функция печатает массив логических элементов функции.
  \end{itemize}
  
  \item Третий модуль используется для записи базовых функций сопроцессора в ассемблерный файл. В нём содержится класс функций {\bf \ttfamily void bind\_*()} где * -- название функции сопроцессора, соответственно функция пишет соответствующую функцию сопроцессора в ассемблерный файл.

\end{enumerate}

Главная программа состоит из двух модулей, на C и Assembly.
\begin{enumerate}
  \item Первый модуль отвечает за подсчёт площади ограниченной тремя кривыми и содержит следующие функции:
  \begin{itemize}
    \item {\bf \ttfamily int process\_flags(char *flg)} функция занимающаяся парсингом флагов поданных программе на вход.
    \item {\bf \ttfamily double ras\_fun(doube fun1(double), double fun2(double),\newline double now)} функция считает разность значений функций поданных на вход.
    \item {\bf \ttfamily double mod(double a)} функция считающая модуль вещественного числа.
    \item {\bf \ttfamily double root(double fun1(double), double fun2(double),\newline double a, double b, double eps)} функция для поиска корней уравнения {\bf \ttfamily fun1 = fun2} на отрезке [a, b] c точностью eps c помощью метода вилки
    \item {\bf \ttfamily integral(double fun(double), double a, double b, double eps)} функция считающая интеграл от поданной на вход функции на заданном отрезке [a, b] с точностью eps.
    \item {\bf \ttfamily double f1f2(double x)} функция считающая разность функций f1 и f2 в точке x.
    \item {\bf \ttfamily double f1f3(double x)} функция считающая разность функций f1 и f3 в точке x.
    \item {\bf \ttfamily double f2f3(double x)} функция считающая разность функций f2 и f3 в точке x.
    \item {\bf \ttfamily double zero\_fun()} функция тождественно равная нулю.
  \end{itemize}
  
  \item Второй модуль автоматически генерируется первой программой на си. Он реализует данные функции на ассемблере, соответственно:
  \begin{itemize}
    \item {\bf \ttfamily double f1(double x)} вычисляет f1 в точке x.
    \item {\bf \ttfamily double f2(double x)} вычисляет f2 в точке x.
    \item {\bf \ttfamily double f3(double x)} вычисляет f3 в точке x.
    \item {\bf \ttfamily double get\_a()} возвращает левую границу отрезка.
    \item {\bf \ttfamily double get\_b()} возвращает правую границу отрезка.
  \end{itemize}
\end{enumerate}

\begin{tikzpicture}[thick,
                    node distance=4cm,
                    text height=1.5ex]

  \tikzstyle{format} = [thick, minimum size=1cm, draw=black!50!black!50]
  \node[format] (main) {main.c};
  \node[format,right of=main] (funct) {functions.asm};

  \path[->] (main) edge (funct);
\end{tikzpicture}


\begin{tikzpicture}[thick,
                    node distance=4cm,
                    text height=1.5ex]

  \tikzstyle{format} = [thick, minimum size=1cm, draw=black!50!black!50]
  \node[format] (genasm) {gen\_asm.c};
  \node[format,right of=genasm] (bindcom) {bind\_commands.c};
  \node[format,left of=genasm] (parsefun) {parse\_fun.c};

  \path[->] (genasm) edge (bindcom);
  \path[->] (genasm) edge (parsefun);
\end{tikzpicture}

\newpage

\section{Сборка программы (Make-файл)}

В данном разделе необходимо описать зависимости между модулями программы
и привести текст Make-файла. Зависимости проще всего описать диаграммой.

\begin{Verbatim}
CXX=gcc
CXXFLAGS=-std=c99 -O2
ADDITIONALFLG=-c

all: main

main: asm functions.o main.c
	${CXX} ${CXXFLAGS} functions.o  main.c -o main -m32 -lm

asm: gen_asm ${SPEC_FILE}
	./gen_asm ${SPEC_FILE} > functions.asm
	nasm -f elf32 functions.asm -o functions.o -D UNIX

gen_asm: gen_asm.c parse_fun.o bind_commands.o
	${CXX} ${CXXFLAGS} gen_asm.c parse_fun.o bind_commands.o -o gen_asm

parse_fun.o: parse_fun.c parse_fun.h
	${CXX} ${CXXFLAGS} ${ADDITIONALFLG} parse_fun.c 

bind_commands.o: bind_commands.c bind_commands.h
	${CXX} ${CXXFLAGS} ${ADDITIONALFLG} bind_commands.c

clean: 
	rm functions.asm main gen_asm *.o
\end{Verbatim}


\begin{tikzpicture}[thick,
                    node distance=4cm,
                    text height=1.5ex]

  \tikzstyle{format} = [thick, minimum size=1cm, draw=black!50!black!50]
  \node[format] (main) {main};
  \node[format,right of=main] (asm) {asm};
  \node[format,right of=asm] (genasm) {gen\_asm};
  \node[format,right of=genasm] (parsefun) {parse\_fun.o};
  \node[format,below of=parsefun] (bindcom) {bind\_commands.o};
  \node[format,below of=main] (clean) {clean};
  \node[format,below of=asm] (specfile) {SPEC\_FILE};

  \path[->] (genasm) edge (bindcom);
  \path[->] (genasm) edge (parsefun);
  \path[->] (main) edge (asm);
  \path[->] (asm) edge (genasm);
  \path[->] (asm) edge (specfile);
\end{tikzpicture}

\newpage

\section{Отладка программы, тестирование функций}
Тестирование программы производилось с помощью специально реальзованных флагов {\ttfamily -testRoot -testIntegral} для тестирования функции вычисления корней и интрегралов соответственно. Для каждого флага программа компилоровалась со специальным значением {\ttfamily SPEC\_FILE}, в котором для тестирования каждой из функций были свои функции. Проверка правильности вычисления корней и интегралов проводилась при помощи аналитического вычисления и дополнительной проверки с помолью Wolfram alpha.

\noindent Для тестировария функции корней использовались следующие функции:
\begin{enumerate}
  \item {$x+2=0$} результаты тестирования для данной функции на отрезке [0, 4]:
  \begin{itemize}
    \item Результат программы: 2.00000
    \item Результат аналитических вычислений: 2
    \item Результат Wolfram alpha: 2.0000
  \end{itemize}
  \item {$(x-3)^2=0$} результаты тестирования для данной функции на отрезке [0, 4]:
  \begin{itemize}
    \item Результат программы: 1.732100
    \item Результат аналитических вычислений: {$\sqrt{3}$}
    \item Результат Wolfram alpha: 1.7321
  \end{itemize}
\item {$x^4+x^2-4$} результаты тестирования для данной функции на отрезке [0, 4]:
  \begin{itemize}
    \item Результат программы: 1.249600
    \item Результат аналитических вычислений: {$\sqrt{\frac{\sqrt{17}}{2}-\frac{1}{2}}$}
    \item Результат Wolfram alpha: 1.2496
  \end{itemize}
\end{enumerate}
Таким образом результаты тестирования функции исчисления корней совпадают с аналитичискими вычислениями.
\newpage
\noindent Для тестирования функции интегралов использовались следующие функции:
\begin{enumerate}
  \item {$x^2+2$} результаты тестирования для данной функции на отрезке [0, 4]:
  \begin{itemize}
    \item Результат программы: 29.333300
    \item Результат аналитических вычислений: {$\int_0^4 \!(x^2+2)\, \mathrm{d}x=\frac{4^3}{3}+2*4=29\frac{1}{3}$}
    \item Результат Wolfram alpha: 29.3333
  \end{itemize}
  \item {$x^3$} результаты тестирования для данной функции на отрезке [0, 4]:
  \begin{itemize}
    \item Результат программы: 64.00000
    \item Результат аналитических вычислений: {$\int_0^4\!x^3\,\mathrm{d}x=64$}
    \item Результат Wolfram alpha: 64
  \end{itemize}
\item {$\sin(x)+1$} результаты тестирования для данной функции на отрезке [0, 4]:
  \begin{itemize}
    \item Результат программы: 5.653700
    \item Результат аналитических вычислений: {$\int_0^4\!\sin(x)+1\,\mathrm{d}x=4-\cos(4)+\cos(0)=5.6536$}
    \item Результат Wolfram alpha: 5.6536
  \end{itemize}
\end{enumerate}

Таким образом результаты тестирования функции исчисления интегралов совпадают с аналитическими вычислениями.

\newpage

\section{Программа на C и Assembly}

Программа реализовывалась на двух языках C и Assembly, причём ассемблерная часть генерировалась отдельной программой также написанной на C. Все тексты программ приложены к отчёту в архиве. 
\newpage

\section{Анализ допущенных ошибок}

\newpage
\begin{raggedright}
\addcontentsline{toc}{section}{Список цитируемой литературы}
\begin{thebibliography}{99}
\bibitem{math} Ильин~В.\,А., Садовничий~В.\,А., Сендов~Бл.\,Х. Математический анализ. Т.\,1~---
    Москва: Наука, 1985.
\end{thebibliography}
\end{raggedright}

\newpage

\section*{Требования к оформлению}

В данном разделе приводятся общие требования к оформлению текста отчета.
Данный раздел не должен включаться в сдаваемый отчет.

\begin{enumerate}
\item Отчет оформляется на листах A4. Поля должны составлять от 2 до 4
    сантиметров и быть одинаковыми на всех страницах отчета.
\item Основной текст отчета оформляется пропорциональным шрифтом с засечками,
    таким как Times New Roman. Размер шрифта может составлять либо 12pt, либо 14pt.
    Межстрочные интервалы могут быть единичными или полуторными в случае 12-го шрифта
    и только единичными в случае использования 14-го шрифта.
\item Никаких дополнительных межстрочных интервалов между абзацами не делается.
    Первая строка абзаца должна иметь небольшой отступ (5-10мм), одинаковый для
    всех абзацев, включая первый абзац раздела.
\item Заголовки первого уровня должны быть набраны более крупным шрифтом (16pt или 18pt).
    В заголовках допускается использование как основного шрифта, так и пропорционального
    шрифта без засечек, такого как Arial. Все заголовки всех уровней должны быть набраны
    одним шрифтом. Размер шрифта заголовков большего уровня не должен превосходить размер
    шрифта заголовков меньшего уровня.
\item Фрагменты программ и сценариев сборки должны быть набраны моноширинным шрифтом, таким
    как Courier. Размер шрифта, используемый в листингах программ может отличаться от размера,
    использованного при наборе основного текста, но должен быть одинаковым во всех частях
    отчета и принадлежать интервалу от 10pt до 14pt.
\item Выделение полужирным и/или курсивом допускается для отдельных слов в основном тексте,
    если это требуется. Заголовки рекомендуется выделять жирным.
\item Основной текст выравнивается по двум сторонам. На титульном листе часть текста
    выравнивается по центру, часть по правом краю. Список литературы и названия разделов 
    выравниваются по левому краю.
\item Таблицы и рисунки выравниваются по центру. Все таблицы и рисунки должны быть пронумерованы
    и подписаны. Нумерация сквозная, отдельная для рисунков и таблиц, арабскими цифрами.
\item При использовании растровых изображения для иллюстраций в отчете
    необходимо обеспечить достаточное разрешение этих изображений. Качество изображения
    считается достаточным, если все надписи на нем легко читаются. Если на тексте, содержащемся
    на рисунке, явно заметно размазывание элементов букв, то такое изображение считается
    слишком низкого качества, и оно не должно быть использовано в отчете.
\item Таблицы должны быть сверстаны как таблицы, а не вставлены как рисунки.
\item Список литературы должен содержать для книг и статей (в соответствующем порядке).
    \begin{itemize}
    \item Фамилии и инициалы (либо полные имена) всех авторов.
    \item Название книги или статьи.
    \item Название журнала и номер тома или выпуска для статей.
    \item Город и год издания.
    \end{itemize}
\item Список литературы для электронных источников должен содержать
    \begin{itemize}
    \item Название страницы.
    \item Полный адрес страницы.
    \item Дата обращения.
    \end{itemize}
\item Ссылки на Википедию и другие электронные ресурсы для оценок численных 
    методов не принимаются. Используйте книги и/или научные статьи в качестве 
    источников данной информации.
\item На все элементы списка литературы должны присутствовать ссылки в тексте отчета. Элементы
    списка литературы должны идти в том порядке, в котором ссылки на них первый
    раз встречаются в тексте.
\item Титульный лист оформляется следующим образом.
    \begin{itemize}
    \item Сверху с выравниванием по центру пишется название ВУЗа и факультета. Данный
        фрагмент пишется заглавными или малыми заглавными буквами.
    \item В центре страницы располагается следующая информация (сверху вниз).
        \begin{itemize}
        \item Наименование работы (<<Отчет по заданию №6>>, без кавычек заглавными
            или малыми заглавными буквами).
        \item Тема работы (<<Сборка многомодульных \dots>>, в кавычках, жирным шрифтом).
        \item Вариант. (Без кавычек жирным шрифтом).
        \end{itemize}
    \item Информация о студенте, выполнившем работу и преподавателе выравнивается
        по правому краю. Данный фрагмент набирается обычным шрифтом.
    \item Внизу страницы с выравниванием по центру обычным или немного уменьшенным
        шрифтом пишется город и год выполнения работы.
    \end{itemize}
\end{enumerate}


\end{document}
